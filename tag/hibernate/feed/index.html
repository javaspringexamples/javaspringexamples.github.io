<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>hibernate &#8211; CoderCocoon</title>
	<atom:link href="http://localhost/wordpress/tag/hibernate/feed/" rel="self" type="application/rss+xml" />
	<link>http://localhost/wordpress</link>
	<description></description>
	<lastBuildDate>Fri, 07 Dec 2018 16:33:52 +0000</lastBuildDate>
	<language>fr-FR</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.0.3</generator>
	<item>
		<title>Example Spring 4 &#8211; HibernateDaoSupport and HibernateCallback</title>
		<link>http://localhost/wordpress/2017/02/07/spring-hibernatedaosupport-hibernatecallback/</link>
		<comments>http://localhost/wordpress/2017/02/07/spring-hibernatedaosupport-hibernatecallback/#respond</comments>
		<pubDate>Tue, 07 Feb 2017 18:39:26 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Hibernate]]></category>
		<category><![CDATA[Spring]]></category>
		<category><![CDATA[hibernate]]></category>
		<category><![CDATA[spring]]></category>

		<guid isPermaLink="false">http://codercocoon.com/?p=189</guid>
		<description><![CDATA[This example presents the basic concept of using in Spring HibernateDaoSupport and HibernateCallback. The technologies used are : Spring 4.3.4, Hibernate 4.3.6, Junit 4.12, JDK 1.8, Maven 3.3.9.]]></description>
				<content:encoded><![CDATA[<p><span id="more-189"></span><br />
This example presents the basic concept of using in Spring HibernateDaoSupport and HibernateCallback.</p>
<p>The technologies used are :</p>
<ul>
<li>Spring 4.3.4</li>
<li>Hibernate 4.3.6</li>
<li>Junit 4.12</li>
<li>JDK 1.8</li>
<li>Maven 3.3.9</li>
</ul>
<p>You can convert this example to an eclipse project by going to folder where is the pom.xml is, and use the following command :</p>
<pre class="brush: plain; title: ; notranslate">mvn eclipse:eclipse</pre>
<p>Here the project files :</p>
<div id="attachment_191" style="width: 376px" class="wp-caption alignnone"><img class="wp-image-191 " src="http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateDaoSupport-and-HibernateCallback-300x266.png" alt="Example Spring 4 - HibernateDaoSupport and HibernateCallback" width="366" height="324" srcset="http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateDaoSupport-and-HibernateCallback-300x266.png 300w, http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateDaoSupport-and-HibernateCallback.png 496w" sizes="(max-width: 366px) 100vw, 366px" /><p class="wp-caption-text">Example Spring 4 &#8211; HibernateDaoSupport and HibernateCallback</p></div>
<pre class="brush: java; highlight: [25,26,29,43,58,74,75]; title: HibernateConfiguration.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateDaoSupport.configuration;

import java.util.Properties;

import javax.sql.DataSource;

import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.orm.hibernate4.HibernateTransactionManager;
import org.springframework.orm.hibernate4.LocalSessionFactoryBean;
import org.springframework.transaction.annotation.EnableTransactionManagement;

@Configuration
@ComponentScan({ &quot;com.codercocoon.springHibernateDaoSupport&quot; })
@PropertySource({ &quot;classpath:application.properties&quot; })
@EnableTransactionManagement
public class HibernateConfiguration {

	@Autowired
	protected Environment environment;

	/**
	 * This method gets the sessionFactory bean.
	 * 
	 * @return LocalSessionFactoryBean.
	 */
	@Bean
	public LocalSessionFactoryBean sessionFactory() {
		LocalSessionFactoryBean sessionFactory = new LocalSessionFactoryBean();
		sessionFactory.setDataSource(dataSource());
		sessionFactory.setPackagesToScan(new String[] { environment.getRequiredProperty(&quot;package.model&quot;) });
		sessionFactory.setHibernateProperties(hibernateProperties());
		return sessionFactory;
	}

	/**
	 * This method gets the dataSource bean.
	 * 
	 * @return DataSource.
	 */
	@Bean
	public DataSource dataSource() {
		DriverManagerDataSource dataSource = new DriverManagerDataSource();
		dataSource.setDriverClassName(environment.getRequiredProperty(&quot;mysql.driver_class&quot;));
		dataSource.setUrl(environment.getRequiredProperty(&quot;mysql.url&quot;));
		dataSource.setUsername(environment.getRequiredProperty(&quot;mysql.username&quot;));
		dataSource.setPassword(environment.getRequiredProperty(&quot;mysql.password&quot;));
		return dataSource;
	}

	/**
	 * This method loads hibernate properties from application.properties.
	 * 
	 * @return Properties.
	 */
	private Properties hibernateProperties() {
		Properties properties = new Properties();
		properties.put(&quot;hibernate.dialect&quot;, environment.getRequiredProperty(&quot;hibernate.dialect&quot;));
		properties.put(&quot;hibernate.show_sql&quot;, environment.getRequiredProperty(&quot;hibernate.show_sql&quot;));
		properties.put(&quot;hibernate.format_sql&quot;, environment.getRequiredProperty(&quot;hibernate.format_sql&quot;));
		properties.put(&quot;hibernate.hbm2ddl.auto&quot;, environment.getRequiredProperty(&quot;hibernate.hbm2ddl.auto&quot;));
		properties.put(&quot;hibernate.hbm2ddl.import_files&quot;,
				environment.getRequiredProperty(&quot;hibernate.hbm2ddl.import_files&quot;));
		return properties;
	}

	/**
	 * This method gets the transactionManager bean, the sessionFactory bean is
	 * autowired and passed in the argument method.
	 * 
	 * @return HibernateTransactionManager.
	 */
	@Bean
	@Autowired
	public HibernateTransactionManager transactionManager(SessionFactory s) {
		HibernateTransactionManager txManager = new HibernateTransactionManager();
		txManager.setSessionFactory(s);
		return txManager;
	}
}
</pre>
<pre class="brush: java; highlight: [7,9,16,23,30,39,46,53]; title: ExampleDao.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateDaoSupport.Dao;

import java.util.List;
import com.codercocoon.springHibernateDaoSupport.model.Example;

/**
 * The DAO interface.
 * 
 * @author contact@codercocoon.com
 *
 */

public interface ExampleDao {

	/**
	 * Gets all examples from the database.
	 * 
	 * @return a list of examples.
	 */
	List&lt;Example&gt; getAllExamples();

	/**
	 * Gets all examples from the database, using Callback.
	 * 
	 * @return a list of examples.
	 */
	public List&lt;Example&gt; getAllExamplesUsingCallback();

	/**
	 * Gets an example by its title.
	 * 
	 * @param title
	 *            : is unique constraint.
	 * @return the example having the title parameter.
	 */
	Example getExampleByTitle(String title);

	/**
	 * Saves the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void saveExample(Example ex);

	/**
	 * Updates the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void updateExample(Example ex);

	/**
	 * Deletes the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void deleteExample(Example ex);
}
</pre>
<pre class="brush: java; highlight: [17,19,28,29,40,44,48,49,50,52,56,57,58,64,68,74,78,82,86,90,94]; title: ExampleDaoImpl.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateDaoSupport.Dao;

import java.util.List;

import org.hibernate.HibernateException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.orm.hibernate4.HibernateCallback;
import org.springframework.orm.hibernate4.support.HibernateDaoSupport;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.codercocoon.springHibernateDaoSupport.model.Example;

/**
 * The DAO implementation.
 * 
 * @author contact@codercocoon.com
 *
 */

@Repository
@Transactional
public class ExampleDaoImpl extends HibernateDaoSupport implements ExampleDao {

	/**
	 * This method sets the sessionFactory bean to the HibernateDaoSupport
	 * instead the final method setSessionFactory().
	 * 
	 * @param sf
	 *            : the sessionFactory bean is wired automatically.
	 */
	@Autowired
	public void autowireSessionFactory(SessionFactory sf) {
		setSessionFactory(sf);
	}

	/**
	 * This method selects all examples from the database.
	 */
	@Override
	public List&lt;Example&gt; getAllExamples() {
		return (List&lt;Example&gt;) getHibernateTemplate().find(&quot;from Example&quot;);
	}

	/**
	 * This method shows a simple example of using Callback, Callback is
	 * generally used to get features that are not available in the
	 * hibernateTemplate.
	 * 
	 * @return the 3 first examples returned in the list.
	 */
	@Override
	public List&lt;Example&gt; getAllExamplesUsingCallback() {
		return getHibernateTemplate().execute(new HibernateCallback&lt;List&lt;Example&gt;&gt;() {
			public List&lt;Example&gt; doInHibernate(Session session) throws HibernateException {
				return session.createCriteria(Example.class).setMaxResults(3).list();
			}
		});
	}

	/**
	 * This method gets an example from the database by its title.
	 */
	@Override
	public Example getExampleByTitle(String title) {
		List&lt;Example&gt; l = (List&lt;Example&gt;) getHibernateTemplate().find(&quot;from Example where title = ?&quot;,
				new Object[] { title });
		return l.isEmpty() ? null : l.get(0);
	}

	/**
	 * This method inserts an example in the database.
	 */
	@Override
	public void saveExample(Example ex) {
		getHibernateTemplate().save(ex);
	}

	/**
	 * This method updates the example passed in arguments.
	 */
	@Override
	public void updateExample(Example ex) {
		getHibernateTemplate().update(ex);
	}

	/**
	 * This method deletes the example passed in arguments.
	 */
	@Override
	public void deleteExample(Example ex) {
		getHibernateTemplate().delete(ex);
	}
}
</pre>
<pre class="brush: java; highlight: [13,14,16,33]; title: Example.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateTemplate.model;

import java.util.Date;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Transient;

/**
 * Example class : we suppose that an example has : id, title, description and a
 * publication date.
 * 
 * @author contact@codercocoon.com
 *
 */
@Entity
public class Example {

	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = &quot;example_id&quot;)
	private int id;

	@Column(unique = true, nullable = false)
	private String title;

	private String description;

	/**
	 * publicationDate will not be persisted.
	 */
	@Transient
	private Date publicationDate;

	public Example() {
	}

	public Example(String title, String description) {
		this.title = title;
		this.description = description;
	}

	/**
	 * Gets Example ID.
	 * 
	 * @return int.
	 */
	public int getExampleId() {
		return id;
	}

	/**
	 * Sets Example ID.
	 * 
	 * @param id.
	 */
	public void setExampleId(int id) {
		this.id = id;
	}

	/**
	 * Gets Title.
	 * 
	 * @return String.
	 */
	public String getTitle() {
		return title;
	}

	/**
	 * Sets Example Title.
	 * 
	 * @param title.
	 */
	public void setTitle(String title) {
		this.title = title;
	}

	/**
	 * Gets Description.
	 * 
	 * @return String.
	 */
	public String getDescription() {
		return description;
	}

	/**
	 * Sets Example Description.
	 * 
	 * @param description.
	 */
	public void setDescription(String description) {
		this.description = description;
	}

	/**
	 * Gets publicationDate.
	 * 
	 * @return Date.
	 */
	public Date getPublicationDate() {
		return publicationDate;
	}

	/**
	 * Sets Example publicationDate.
	 * 
	 * @param description.
	 */
	public void setPublicationDate(Date publicationDate) {
		this.publicationDate = publicationDate;
	}

	public String toString() {
		return id + &quot; - &quot; + title + &quot; - &quot; + description;
	}
}
</pre>
<pre class="brush: plain; highlight: [2,4,11,14]; title: application.properties; notranslate">
mysql.driver_class=com.mysql.jdbc.Driver
#The database will be created if it's not exist.
mysql.url=jdbc:mysql://localhost:3306/example_hibernate_dao_support?createDatabaseIfNotExist=true
#Don't forget to configure your login and password to connect to your MySQL server.
mysql.username=root
mysql.password=
hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
hibernate.show_sql=false
hibernate.format_sql=true
hibernate.hbm2ddl.auto=create
#Some data to populate the database.
hibernate.hbm2ddl.import_files=populate_data.sql
hibernate.connection.autocommit=true
#The package to scan to get models.
package.model=com.codercocoon.springHibernateDaoSupport.model
</pre>
<pre class="brush: sql; highlight: [1]; title: populate_data.sql; notranslate">
--Insert examples
INSERT INTO `example` (`title`, `description`) VALUES ('example title 1', 'example description 1');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 2', 'example description 2');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 3', 'example description 3');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 4', 'example description 4');
</pre>
<pre class="brush: java; highlight: [18,20,35,45,46,47,60,61,72,73,81,82]; title: TestCase.java; notranslate">
package com.codercocoon.test.springHibernateDaoSupport;

import java.util.Date;

import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.codercocoon.springHibernateDaoSupport.Dao.ExampleDao;
import com.codercocoon.springHibernateDaoSupport.configuration.HibernateConfiguration;
import com.codercocoon.springHibernateDaoSupport.model.Example;

/**
 * Test class instead annotation-based config.
 * 
 * @author contact@codercocoon.com
 *
 */

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = { HibernateConfiguration.class })
public class TestCase {

	@Autowired
	ExampleDao exampleDao;

	private final String TITLE = &quot;example title&quot;;
	private final Example example = new Example(TITLE, &quot;example description&quot;);

	/**
	 * This test checks if the example is well inserted in the database.
	 */
	@Test
	@Rollback(false)
	public void testInsertExample() {
		exampleDao.saveExample(example);
		Assert.assertTrue(TITLE.equals(exampleDao.getExampleByTitle(TITLE).getTitle()));
	}

	/**
	 * This test checks if the example is well updated, for the modification of
	 * title which is unique, we concatenate it with the date containing
	 * seconds, to allow running the test many times.
	 */
	@Test
	@Rollback(false)
	public void testUpdateExample() {
		Example ex = getExample();
		ex.setTitle(&quot;title modified &quot;.concat(new Date().toString()));
		exampleDao.updateExample(ex);
		ex = exampleDao.getExampleByTitle(TITLE);
		Assert.assertNull(ex);
	}

	/**
	 * This test checks if the example is well deleted, the delete operation is
	 * rolled back in this case.
	 */
	@Test
	public void testDeleteExample() {
		Example ex = getExample();
		exampleDao.deleteExample(ex);
		ex = exampleDao.getExampleByTitle(TITLE);
		Assert.assertNull(ex);
	}

	/**
	 * This test checks getting examples from database by using Callback, the
	 * size must be 3.
	 */
	@Test
	public void testExamplesByUsingCallback() {
		Assert.assertEquals(3, exampleDao.getAllExamplesUsingCallback().size());
	}

	/**
	 * This method insert the example if not exist in the database, the object
	 * inserted is the &quot;example&quot; attribute.
	 */
	private Example getExample() {
		Example ex = exampleDao.getExampleByTitle(TITLE);
		if (ex == null) {
			exampleDao.saveExample(example);
			ex = exampleDao.getExampleByTitle(TITLE);
		}
		return ex;
	}
}
</pre>
<pre class="brush: xml; highlight: [12,13,14,15,63]; title: pom.xml; notranslate">
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;groupId&gt;com.codercocoon.spring&lt;/groupId&gt;
	&lt;artifactId&gt;example-HibernateTemplate-HibernateCallback&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;packaging&gt;jar&lt;/packaging&gt;

	&lt;name&gt;example HibernateTemplate and HibernateCallback&lt;/name&gt;

	&lt;properties&gt;
		&lt;springframework.version&gt;4.3.4.RELEASE&lt;/springframework.version&gt;
		&lt;hibernate.version&gt;4.3.6.Final&lt;/hibernate.version&gt;
		&lt;junit.version&gt;4.12&lt;/junit.version&gt;
		&lt;mysql.version&gt;5.1.31&lt;/mysql.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-context&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-test&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;version&gt;${junit.version}&lt;/version&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;!-- Spring ORM Support --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;!-- Hibernate --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
			&lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
			&lt;version&gt;${hibernate.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;!-- MySQL --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;mysql&lt;/groupId&gt;
			&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
			&lt;version&gt;${mysql.version}&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
				&lt;version&gt;3.6.0&lt;/version&gt;
				&lt;configuration&gt;
					&lt;source&gt;1.8&lt;/source&gt;
					&lt;target&gt;1.8&lt;/target&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
</pre>
<p><a href="https://github.com/codercocoon/springHibernateTemplate.git">Get the sources of the example from the following GitHub url</a></p>
<p>Or <a href="https://github.com/codercocoon/springHibernateTemplate/archive/master.zip">Download a .zip file</a></p>
]]></content:encoded>
			<wfw:commentRss>http://localhost/wordpress/2017/02/07/spring-hibernatedaosupport-hibernatecallback/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Example Spring 4 &#8211; HibernateTemplate and HibernateCallback</title>
		<link>http://localhost/wordpress/2017/02/06/spring-hibernatetemplate-hibernatecallback/</link>
		<comments>http://localhost/wordpress/2017/02/06/spring-hibernatetemplate-hibernatecallback/#respond</comments>
		<pubDate>Mon, 06 Feb 2017 18:43:21 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Hibernate]]></category>
		<category><![CDATA[Spring]]></category>
		<category><![CDATA[hibernate]]></category>
		<category><![CDATA[spring]]></category>

		<guid isPermaLink="false">http://codercocoon.com/?p=166</guid>
		<description><![CDATA[This example presents the basic concept of using in Spring HibernateTemplate and HibernateCallback. The technologies used are : Spring 4.3.4, Hibernate 4.3.6, Junit 4.12, JDK 1.8, Maven 3.3.9.]]></description>
				<content:encoded><![CDATA[<p><span id="more-166"></span><br />
This example presents the basic concept of using in Spring HibernateTemplate and HibernateCallback.</p>
<p>The technologies used are :</p>
<ul>
<li>Spring 4.3.4</li>
<li>Hibernate 4.3.6</li>
<li>Junit 4.12</li>
<li>JDK 1.8</li>
<li>Maven 3.3.9</li>
</ul>
<p>You can convert this example to an eclipse project by going to folder where is the pom.xml is, and use the following command :</p>
<pre class="brush: plain; title: ; notranslate">mvn eclipse:eclipse</pre>
<p>Here the project files :</p>
<div id="attachment_168" style="width: 380px" class="wp-caption alignnone"><img class="wp-image-168 " src="http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateTemplate-and-HibernateCallback-300x290.png" alt="Example Spring 4 - HibernateTemplate and HibernateCallback" width="370" height="358" srcset="http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateTemplate-and-HibernateCallback-300x290.png 300w, http://localhost/wordpress/wp-content/uploads/2017/02/Example-Spring-4-HibernateTemplate-and-HibernateCallback.png 478w" sizes="(max-width: 370px) 100vw, 370px" /><p class="wp-caption-text">Example Spring 4 &#8211; HibernateTemplate and HibernateCallback</p></div>
<pre class="brush: java; highlight: [20,22,36,50,65,66,82,83]; title: HibernateConfiguration.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateTemplate.configuration;

import java.util.Properties;

import javax.sql.DataSource;

import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.orm.hibernate4.HibernateTransactionManager;
import org.springframework.orm.hibernate4.LocalSessionFactoryBean;
import org.springframework.transaction.annotation.EnableTransactionManagement;

/**
 * The configuration class.
 * 
 * @author contact@codercocoon.com
 *
 */

@Configuration
@ComponentScan({ &quot;com.codercocoon.springHibernateTemplate&quot; })
@PropertySource({ &quot;classpath:application.properties&quot; })
@EnableTransactionManagement
public class HibernateConfiguration {

	@Autowired
	protected Environment environment;

	/**
	 * This method gets the sessionFactory bean.
	 * 
	 * @return LocalSessionFactoryBean.
	 */
	@Bean
	public LocalSessionFactoryBean sessionFactory() {
		LocalSessionFactoryBean sessionFactory = new LocalSessionFactoryBean();
		sessionFactory.setDataSource(dataSource());
		sessionFactory.setPackagesToScan(new String[] { environment.getRequiredProperty(&quot;package.model&quot;) });
		sessionFactory.setHibernateProperties(hibernateProperties());
		return sessionFactory;
	}

	/**
	 * This method gets the dataSource bean.
	 * 
	 * @return DataSource.
	 */
	@Bean
	public DataSource dataSource() {
		DriverManagerDataSource dataSource = new DriverManagerDataSource();
		dataSource.setDriverClassName(environment.getRequiredProperty(&quot;mysql.driver_class&quot;));
		dataSource.setUrl(environment.getRequiredProperty(&quot;mysql.url&quot;));
		dataSource.setUsername(environment.getRequiredProperty(&quot;mysql.username&quot;));
		dataSource.setPassword(environment.getRequiredProperty(&quot;mysql.password&quot;));
		return dataSource;
	}

	/**
	 * This method loads hibernate properties from the application.properties
	 * file.
	 * 
	 * @return Properties.
	 */
	private Properties hibernateProperties() {
		Properties properties = new Properties();
		properties.put(&quot;hibernate.dialect&quot;, environment.getRequiredProperty(&quot;hibernate.dialect&quot;));
		properties.put(&quot;hibernate.show_sql&quot;, environment.getRequiredProperty(&quot;hibernate.show_sql&quot;));
		properties.put(&quot;hibernate.format_sql&quot;, environment.getRequiredProperty(&quot;hibernate.format_sql&quot;));
		properties.put(&quot;hibernate.hbm2ddl.auto&quot;, environment.getRequiredProperty(&quot;hibernate.hbm2ddl.auto&quot;));
		properties.put(&quot;hibernate.hbm2ddl.import_files&quot;,
				environment.getRequiredProperty(&quot;hibernate.hbm2ddl.import_files&quot;));
		return properties;
	}

	/**
	 * This method gets the transactionManager bean, the sessionFactory bean is
	 * autowired and passed in the argument method.
	 * 
	 * @return HibernateTransactionManager.
	 */
	@Bean
	@Autowired
	public HibernateTransactionManager transactionManager(SessionFactory s) {
		HibernateTransactionManager txManager = new HibernateTransactionManager();
		txManager.setSessionFactory(s);
		return txManager;
	}
}
</pre>
<pre class="brush: java; highlight: [8,10,16,23,30,39,46,53]; title: ExampleDao.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateTemplate.Dao;

import java.util.List;

import com.codercocoon.springHibernateTemplate.model.Example;

/**
 * The DAO interface.
 * 
 * @author contact@codercocoon.com
 *
 */
public interface ExampleDao {

	/**
	 * Gets all examples from the database.
	 * 
	 * @return a list of examples.
	 */
	List&lt;Example&gt; getAllExamples();

	/**
	 * Gets all examples from the database, using Callback.
	 * 
	 * @return a list of examples.
	 */
	List&lt;Example&gt; getAllExamplesUsingCallback();

	/**
	 * Gets an example by its title.
	 * 
	 * @param title
	 *            : is unique constraint.
	 * @return the example having the title parameter.
	 */
	Example getExampleByTitle(String title);

	/**
	 * Saves the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void saveExample(Example ex);

	/**
	 * Updates the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void updateExample(Example ex);

	/**
	 * Deletes the example passed in the parameter.
	 * 
	 * @param ex
	 */
	void deleteExample(Example ex);
}
</pre>
<pre class="brush: java; highlight: [17,19,30,40,44,48,49,50,52,56,57,58,64,68,74,78,82,86,90,94]; title: ExampleDaoImpl.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateTemplate.Dao;

import java.util.List;

import org.hibernate.HibernateException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.orm.hibernate4.HibernateCallback;
import org.springframework.orm.hibernate4.HibernateTemplate;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.codercocoon.springHibernateTemplate.model.Example;

/**
 * The DAO implementation.
 * 
 * @author contact@codercocoon.com
 *
 */

@Repository
@Transactional
public class ExampleDaoImpl implements ExampleDao {

	private HibernateTemplate hibernateTemplate;

	/**
	 * Sets the sessionFectory bean.
	 * 
	 * @param sessionFactory
	 */
	@Autowired
	public void setSessionFactory(SessionFactory sessionFactory) {
		this.hibernateTemplate = new HibernateTemplate(sessionFactory);
	}

	/**
	 * This method selects all examples from the database.
	 */
	@Override
	public List&lt;Example&gt; getAllExamples() {
		return (List&lt;Example&gt;) this.hibernateTemplate.find(&quot;from Example&quot;);
	}

	/**
	 * This method shows a simple example of using Callback, Callback is
	 * generally used to get features that are not available in the
	 * hibernateTemplate.
	 * 
	 * @return the 3 first examples returned in the list.
	 */
	@Override
	public List&lt;Example&gt; getAllExamplesUsingCallback() {
		return this.hibernateTemplate.execute(new HibernateCallback&lt;List&lt;Example&gt;&gt;() {
			public List&lt;Example&gt; doInHibernate(Session session) throws HibernateException {
				return session.createCriteria(Example.class).setMaxResults(3).list();
			}
		});
	}

	/**
	 * This method gets an example from the database by its title.
	 */
	@Override
	public Example getExampleByTitle(String title) {
		List&lt;Example&gt; l = (List&lt;Example&gt;) this.hibernateTemplate.find(&quot;from Example where title = ?&quot;,
				new Object[] { title });
		return l.isEmpty() ? null : l.get(0);
	}

	/**
	 * This method inserts an example in the database.
	 */
	@Override
	public void saveExample(Example ex) {
		this.hibernateTemplate.save(ex);
	}

	/**
	 * This method updates the example passed in arguments.
	 */
	@Override
	public void updateExample(Example ex) {
		this.hibernateTemplate.update(ex);
	}

	/**
	 * This method deletes the example passed in arguments.
	 */
	@Override
	public void deleteExample(Example ex) {
		this.hibernateTemplate.delete(ex);
	}
}
</pre>
<pre class="brush: java; highlight: [13,14,16,33]; title: Example.java; toolbar: true; notranslate">
package com.codercocoon.springHibernateTemplate.model;

import java.util.Date;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Transient;

/**
 * Example class : we suppose that an example has : id, title, description and a
 * publication date.
 * 
 * @author contact@codercocoon.com
 *
 */
@Entity
public class Example {

	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = &quot;example_id&quot;)
	private int id;

	@Column(unique = true, nullable = false)
	private String title;

	private String description;

	/**
	 * publicationDate will not be persisted.
	 */
	@Transient
	private Date publicationDate;

	public Example() {
	}

	public Example(String title, String description) {
		this.title = title;
		this.description = description;
	}

	/**
	 * Gets Example ID.
	 * 
	 * @return int.
	 */
	public int getExampleId() {
		return id;
	}

	/**
	 * Sets Example ID.
	 * 
	 * @param id.
	 */
	public void setExampleId(int id) {
		this.id = id;
	}

	/**
	 * Gets Title.
	 * 
	 * @return String.
	 */
	public String getTitle() {
		return title;
	}

	/**
	 * Sets Example Title.
	 * 
	 * @param title.
	 */
	public void setTitle(String title) {
		this.title = title;
	}

	/**
	 * Gets Description.
	 * 
	 * @return String.
	 */
	public String getDescription() {
		return description;
	}

	/**
	 * Sets Example Description.
	 * 
	 * @param description.
	 */
	public void setDescription(String description) {
		this.description = description;
	}

	/**
	 * Gets publicationDate.
	 * 
	 * @return Date.
	 */
	public Date getPublicationDate() {
		return publicationDate;
	}

	/**
	 * Sets Example publicationDate.
	 * 
	 * @param description.
	 */
	public void setPublicationDate(Date publicationDate) {
		this.publicationDate = publicationDate;
	}

	public String toString() {
		return id + &quot; - &quot; + title + &quot; - &quot; + description;
	}
}
</pre>
<pre class="brush: plain; highlight: [2,4,11,14]; title: application.properties; notranslate">
mysql.driver_class=com.mysql.jdbc.Driver
#The database will be created if it's not exist.
mysql.url=jdbc:mysql://localhost:3306/example_hibernate_template?createDatabaseIfNotExist=true
#Don't forget to configure your login and password to connect to your MySQL server. 
mysql.username=root
mysql.password=
hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
hibernate.show_sql=false
hibernate.format_sql=true
hibernate.hbm2ddl.auto=create
#Some data to populate the database.
hibernate.hbm2ddl.import_files=populate_data.sql
hibernate.connection.autocommit=true
#The package to scan to get models.
package.model=com.codercocoon.springHibernateTemplate.model
</pre>
<pre class="brush: sql; highlight: [1]; title: populate_data.sql; notranslate">
--Insert some examples in the database.
INSERT INTO `example` (`title`, `description`) VALUES ('example title 1', 'example description 1');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 2', 'example description 2');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 3', 'example description 3');
INSERT INTO `example` (`title`, `description`) VALUES ('example title 4', 'example description 4');
</pre>
<pre class="brush: java; highlight: [18,20,34,44,45,46,59,60,71,72,80,81]; title: ApplicationAnnotationConfigTest.java; notranslate">
package com.codercocoon.test.springHibernateTemplate;

import java.util.Date;

import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.codercocoon.springHibernateTemplate.Dao.ExampleDao;
import com.codercocoon.springHibernateTemplate.configuration.HibernateConfiguration;
import com.codercocoon.springHibernateTemplate.model.Example;

/**
 * Test class instead annotation-based config.
 * 
 * @author contact@codercocoon.com
 *
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = { HibernateConfiguration.class })
public class ApplicationAnnotationConfigTest {

	@Autowired
	ExampleDao exampleDao;

	private final String TITLE = &quot;example title&quot;;
	private final Example example = new Example(TITLE, &quot;example description&quot;);

	/**
	 * This test checks if the example is well inserted in the database.
	 */
	@Test
	@Rollback(false)
	public void testInsertExample() {
		exampleDao.saveExample(example);
		Assert.assertTrue(TITLE.equals(exampleDao.getExampleByTitle(TITLE).getTitle()));
	}

	/**
	 * This test checks if the example is well updated, for the modification of
	 * title which is unique, we concatenate it with the date containing
	 * seconds, to allow running the test many times.
	 */
	@Test
	@Rollback(false)
	public void testUpdateExample() {
		Example ex = getExample();
		ex.setTitle(&quot;title modified &quot;.concat(new Date().toString()));
		exampleDao.updateExample(ex);
		ex = exampleDao.getExampleByTitle(TITLE);
		Assert.assertNull(ex);
	}

	/**
	 * This test checks if the example is well deleted, the delete operation is
	 * rolled back in this case.
	 */
	@Test
	public void testDeleteExample() {
		Example ex = getExample();
		exampleDao.deleteExample(ex);
		ex = exampleDao.getExampleByTitle(TITLE);
		Assert.assertNull(ex);
	}

	/**
	 * This test checks getting examples from database by using Callback, the
	 * size must be 3, cause we get only the 3 first examples.
	 */
	@Test
	public void testExamplesByUsingCallback() {
		Assert.assertEquals(3, exampleDao.getAllExamplesUsingCallback().size());
	}

	/**
	 * This method insert the example if not exist in the database, the object
	 * inserted is the &quot;example&quot; attribute.
	 */
	private Example getExample() {
		Example ex = exampleDao.getExampleByTitle(TITLE);
		if (ex == null) {
			exampleDao.saveExample(example);
			ex = exampleDao.getExampleByTitle(TITLE);
		}
		return ex;
	}
}
</pre>
<pre class="brush: xml; highlight: [12,13,14,15,63]; title: pom.xml; notranslate">
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;groupId&gt;com.codercocoon.spring&lt;/groupId&gt;
	&lt;artifactId&gt;example-HibernateTemplate-HibernateCallback&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;packaging&gt;jar&lt;/packaging&gt;

	&lt;name&gt;example HibernateTemplate and HibernateCallback&lt;/name&gt;

	&lt;properties&gt;
		&lt;springframework.version&gt;4.3.4.RELEASE&lt;/springframework.version&gt;
		&lt;hibernate.version&gt;4.3.6.Final&lt;/hibernate.version&gt;
		&lt;junit.version&gt;4.12&lt;/junit.version&gt;
		&lt;mysql.version&gt;5.1.31&lt;/mysql.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-context&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-test&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;version&gt;${junit.version}&lt;/version&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;!-- Spring ORM Support --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;!-- Hibernate --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
			&lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
			&lt;version&gt;${hibernate.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;!-- MySQL --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;mysql&lt;/groupId&gt;
			&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
			&lt;version&gt;${mysql.version}&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
				&lt;version&gt;3.6.0&lt;/version&gt;
				&lt;configuration&gt;
					&lt;source&gt;1.8&lt;/source&gt;
					&lt;target&gt;1.8&lt;/target&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
</pre>
<p><a href="https://github.com/codercocoon/springHibernateTemplate.git">Get the sources of the example from the following GitHub url</a></p>
<p>Or <a href="https://github.com/codercocoon/springHibernateTemplate/archive/master.zip">Download a .zip file</a></p>
]]></content:encoded>
			<wfw:commentRss>http://localhost/wordpress/2017/02/06/spring-hibernatetemplate-hibernatecallback/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
